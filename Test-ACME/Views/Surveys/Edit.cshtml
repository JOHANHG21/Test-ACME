@model Test_ACME.Models.Survey

@{
    ViewData["Title"] = "Editar Encuesta";
}

<h1>Editar Encuesta</h1>

<form asp-action="Edit" method="post">
    <input type="hidden" asp-for="Id" />

    <div class="form-group">
        <label asp-for="Name" class="control-label"></label>
        <input asp-for="Name" class="form-control" />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Description" class="control-label"></label>
        <textarea asp-for="Description" class="form-control"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <!-- Tabla dinámica para campos -->
    <div class="form-group">
        <label>Campos de la Encuesta</label>
        <table id="fieldsTable" class="table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Título</th>
                    <th>Requerido</th>
                    <th>Tipo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var fieldsList = Model.Fields?.ToList() ?? new List<Test_ACME.Models.SurveyField>();
                }
                @for (int i = 0; i < fieldsList.Count; i++)
                {
                    var field = fieldsList[i];
                    <tr>
                        <td><input type="text" name="Fields[@i].Name" value="@field.Name" class="form-control" required /></td>
                        <td><input type="text" name="Fields[@i].Title" value="@field.Title" class="form-control" required /></td>
                        <td><input type="checkbox" name="Fields[@i].IsRequired" @(field.IsRequired ? "checked" : "") class="form-check-input" /></td>
                        <td>
                            <select name="Fields[@i].FieldType" class="form-control" required>
                                <option value="Texto" selected="@(field.FieldType == "Texto")">Texto</option>
                                <option value="Número" selected="@(field.FieldType == "Número")">Número</option>
                                <option value="Fecha" selected="@(field.FieldType == "Fecha")">Fecha</option>
                            </select>

                        </td>
                        <td><button type="button" class="btn btn-danger" onclick="this.closest('tr').remove()">Eliminar</button></td>
                    </tr>
                }
            </tbody>

        </table>
        <button type="button" id="addField" class="btn btn-secondary">Añadir Campo</button>
    </div>

    <div class="form-group">
        <input type="submit" value="Guardar" class="btn btn-primary" />
        <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
    </div>
</form>

@section Scripts {
    <script>
        document.getElementById('addField').addEventListener('click', function () {
            const table = document.getElementById('fieldsTable').getElementsByTagName('tbody')[0];
            const row = table.insertRow();
            row.innerHTML = `
                        <td><input type="text" name="Fields[${table.rows.length - 1}].Name" class="form-control" required /></td>
                        <td><input type="text" name="Fields[${table.rows.length - 1}].Title" class="form-control" required /></td>
                        <td><input type="checkbox" name="Fields[${table.rows.length - 1}].IsRequired" class="form-check-input" /></td>
                        <td>
                            <select name="Fields[${table.rows.length - 1}].FieldType" class="form-control" required>
                                <option value="Texto">Texto</option>
                                <option value="Número">Número</option>
                                <option value="Fecha">Fecha</option>
                            </select>
                        </td>
                        <td><button type="button" class="btn btn-danger" onclick="this.closest('tr').remove()">Eliminar</button></td>
                    `;
        });
    </script>
}
